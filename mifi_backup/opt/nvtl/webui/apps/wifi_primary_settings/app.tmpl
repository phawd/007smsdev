<tmpl_if isHidden>
    <div class="notification app error">
        <tmpl_var _("webui", "webui_app_hidden_text")>
    </div>
<tmpl_else>
    <script type="text/javascript">
        var validated = false;
        var previousSecurityOption = parseInt("<tmpl_var WifiPrimarySecurity>");
        var previousPassword = "<tmpl_var WifiPrimaryPassword>";

        $(function()
        {
            if ($("#WifiPrimarySecurity").val() == 0) {
                $("#WifiPrimaryPassword").val("");
                $("#WifiPrimaryPassword").prop("disabled", true);
                $("#GenerateNewPassword").prop("disabled", true);
                if (jQuery.uniform) $.uniform.update("#WifiPrimaryPassword","#GenerateNewPassword");
            }

            $("#WifiPrimarySecurity").focus(function() {
                previousSecurityOption = $("#WifiPrimarySecurity").val();
            }).change(function() {
                var securityType = $("#WifiPrimarySecurity").val();

                <tmpl_if ShowWifiSecurityNone>
                    if (securityType == 0) {                        
                        showNoSecurityConfirmation(previousSecurityOption);
                    } else {
                        $("#WifiPrimaryPassword").prop("disabled", false);
                        $("#GenerateNewPassword").prop("disabled", false);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimaryPassword", "#GenerateNewPassword");
                    }
                </tmpl_if>

            });

            $("#GenerateNewPassword").on("click", function() {
                generateNewPassword();
            });

            $("#WifiPrimaryPrivacyEnabled").on("change", function() {
                if ($("#WifiPrimaryPrivacyEnabled").is(":checked")) {
                    showWarning("<tmpl_var _("webui", "wifi_primary_privacy_warning_text")>");                    
                }
            });

            $("#WifiPrimaryWpsEnabled").on("change", function() {
                var securityType = $("#WifiPrimarySecurity").val();
                if ($("#WifiPrimaryWpsEnabled").is(":checked")) {
                    if (!$("#WifiPrimaryBroadcastSsid").is(":checked")) {
                        showWpsOnConfirmation();
                    } else if("<tmpl_var MacFilterEnable>" == "on" ) {
                        showWarning("<tmpl_var _("webui", "wifi_primary_wps_change_macfilter_enabled_text")>");
                        $("#WifiPrimaryWpsEnabled").prop("checked", false);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimaryWpsEnabled");
                    }
                }
            });

            $("#WifiPrimaryBroadcastSsid").on("change", function() {
                if ($("#WifiPrimaryWpsEnabled").is(":checked") && (!$("#WifiPrimaryBroadcastSsid").is(":checked"))) {
                    showBroadcastOffConfirmation();
                }
            });

            $("#wifi_primary_settings_form").on("submit", function() {
                if (validated) {
                        return true;
                } else {
                        return showSaveChangesConfirmation();
                }
            });
        });

        function generateNewPassword() {
            var url = "<tmpl_udf GET_URI('wifi_primary_settings_generate_password')>";

            $.ajax({
                url : url,
                type : "GET",
                success: function(data) {
                    previousPassword = $("#WifiPrimaryPassword").val();
                    $("#WifiPrimaryPassword").val(data["GeneratedPassword"]);
                    if (jQuery.uniform) $.uniform.update("#WifiPrimaryPassword");
                },
                error : function(xhr, textStatus, errorThrown) {
                    // If auth session has ended, force a new login with a fresh GET.
                    if( (xhr.status == 401) || (xhr.status == 403) || (xhr.status == 406) ) {
                        window.location.replace(window.location.href);
                    } else  {
                        return false;
                    }
                }
            });          
        }

        function showSaveChangesConfirmation() {
            if (("[<tmpl_var WifiPrimarySsid>]" !== "["+$("#WifiPrimarySsid").val()+"]") || 
                ("[<tmpl_var WifiPrimarySecurity>]" !== "["+$("#WifiPrimarySecurity").val()+"]") || 
                ("[<tmpl_var WifiPrimaryPassword>]" !== "["+$("#WifiPrimaryPassword").val()+"]")) {
                modalPopup.createWindow('<tmpl_var _("webui", "webui_modal_title")>', '<p><tmpl_udf GET_PO_TEXT("wifi_primary_save_changes_confirmation_text", gProductName)></p>', 430, 250, [{
                        text : '<tmpl_var _("webui", "webui_modal_cancel_button")>',
                        className : "cancel",
                        trigger : function () {
                            validated = false;
                        }
                }, {
                        text : '<tmpl_var _("webui", "webui_modal_confirm_button")>',
                        className : "primary",
                        trigger : function() {
                                validated = true;
                                $("#intro").hide();
                                $("#introLostConnection").show();
                                $("#wifi_primary_settings_form").submit();
                        }
                }], null, function(){
                        validated = false;
                });
            } else {
                validated = true;
                $("#wifi_primary_settings_form").submit();
            }
            return false;
        }

        function showWarning(text) {            
            modalPopup.createWindow('<tmpl_var _("webui", "webui_app_warning_title")>', '<p>'+text+'</p>', 430, 250, [{
                text : '<tmpl_var _("webui", "webui_modal_ok_button")>',
                className : "primary",
                trigger : function() {
                    // do nothing
                }
            }], null, function() {
                // do nothing
            });
        }

        function showNoSecurityConfirmation(previousSecurityOption) {
            modalPopup.createWindow('<tmpl_var _("webui", "webui_modal_title")>', '<p><tmpl_udf GET_PO_TEXT("wifi_primary_security_none_warning_text", gProductName)></p>', 430, 250, [{
                    text : '<tmpl_var _("webui", "webui_modal_cancel_button")>',
                    className : "cancel",
                    trigger : function() {
                        $("#WifiPrimarySecurity").val(previousSecurityOption);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimarySecurity");
                    }
            }, {
                    text : '<tmpl_var _("webui", "webui_modal_confirm_button")>',
                    className : "primary",
                    trigger : function() {
                        $("#WifiPrimaryPassword").val("");
                        $("#WifiPrimaryPassword").prop("disabled", true);
                        $("#GenerateNewPassword").prop("disabled", true);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimaryPassword", "#GenerateNewPassword");
                    }
            }], null, function(){
                $("#WifiPrimarySecurity").val(previousSecurityOption);
                if (jQuery.uniform) $.uniform.update("#WifiPrimarySecurity");
            });
        }

        function showWpsOnConfirmation() {
            modalPopup.createWindow('<tmpl_var _("webui", "webui_modal_title")>', '<p><tmpl_var _("webui", "wifi_primary_wps_change_broadcast_incompatible_warning_text")></p>', 430, 250, [{
                    text : '<tmpl_var _("webui", "webui_modal_cancel_button")>',
                    className : "cancel",
                    trigger : function() {
                        $("#WifiPrimaryWpsEnabled").prop("checked", false);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimaryWpsEnabled");
                    }
            }, {
                    text : '<tmpl_var _("webui", "webui_modal_confirm_button")>',
                    className : "primary",
                    trigger : function() {
                        $("#WifiPrimaryWpsEnabled").prop("checked", true);
                        $("#WifiPrimaryBroadcastSsid").prop("checked", true);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimaryWpsEnabled, #WifiPrimaryBroadcastSsid");
                    }
            }], null, function(){
                $("#WifiPrimaryWpsEnabled").prop("checked", false);
                if (jQuery.uniform) $.uniform.update("#WifiPrimaryWpsEnabled");
            });
            
        }

        function showBroadcastOffConfirmation() {
            modalPopup.createWindow('<tmpl_var _("webui", "webui_modal_title")>', "<p><tmpl_var _('webui', 'wifi_primary_broadcast_change_wps_incompatible_warning_text')></p>", 430, 250, [{
                    text : '<tmpl_var _("webui", "webui_modal_cancel_button")>',
                    className : "cancel",
                    trigger : function() {
                        $("#WifiPrimaryBroadcastSsid").prop("checked", true);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimaryBroadcastSsid");
                    }
            }, {
                    text : '<tmpl_var _("webui", "webui_modal_confirm_button")>',
                    className : "primary",
                    trigger : function() {
                        $("#WifiPrimaryWpsEnabled").prop("checked", false);
                        $("#WifiPrimaryBroadcastSsid").prop("checked", false);
                        if (jQuery.uniform) $.uniform.update("#WifiPrimaryWpsEnabled, #WifiPrimaryBroadcastSsid");
                    }
            }], null, function(){
                $("#WifiPrimaryBroadcastSsid").prop("checked", true);
                if (jQuery.uniform) $.uniform.update("#WifiPrimaryBroadcastSsid");
            });
        }

    </script>

    <tmpl_if isLocked>
        <div class="notification app error">
            <tmpl_var _("webui", "webui_app_locked_text")>
        </div>
    </tmpl_if>

    <tmpl_if errorCount>
        <div class="notification app error">
            <div class="notification_inner">
                <tmpl_var _("webui", "webui_save_code_failed_text")>
            </div>
        </div>
    </tmpl_if>

    <tmpl_if gPostSuccess>
        <div class="notification app success">
            <div class="notification_inner">
                <tmpl_var _("webui", "webui_save_code_success_text")>
            </div>
        </div>
    </tmpl_if>

    <p>
        <tmpl_udf GET_PO_TEXT("wifi_primary_intro_text", gProductName)>
    </p>

    <p class="warning" id="introLostConnection" style="display:none">
        <tmpl_udf GET_PO_TEXT("wifi_primary_connection_lost_text", gProductName)>
    </p>

    <form id="wifi_primary_settings_form" method="POST" action="<tmpl_udf GET_URI('wifi_primary_settings')>" >
        <input type="hidden" name="gSecureToken" id="gSecureToken" value="<tmpl_var gSecureToken>" />
        <div class="table">
            <div class="row clearfix">
                <div class="col-primary">
                    <div class="row clearfix">
                        <div class="col label-teeny">
                            <label for="WifiPrimarySsid"><tmpl_var _("webui", "wifi_primary_ssid_label")></label>
                        </div>
                        <div class="col input-textbox">
                            <input type="text" id="WifiPrimarySsid" name="WifiPrimarySsid" value="<tmpl_var WifiPrimarySsid>" <tmpl_if WifiPrimarySsidError>class="error"</tmpl_if> />
                        </div>
                        <tmpl_if WifiPrimarySsidError>
                            <div class="col inline_error">
                                <tmpl_var WifiPrimarySsidError>
                            </div>
                        </tmpl_if>
                    </div>

                    <div class="row clearfix">
                        <div class="col label-teeny">
                            <label for="WifiPrimarySecurity"><tmpl_var _("webui", "wifi_primary_security_label")></label>
                        </div>
                        <div class="col input-textbox">
                            <select id="WifiPrimarySecurity" name="WifiPrimarySecurity">
                                <tmpl_include "wifi_security_options.tmpl">
                            </select>
                        </div>
                    </div>

                    <div class="row clearfix">
                        <div class="col label-teeny">
                            <label for="WifiPrimaryPassword"><tmpl_var _("webui", "wifi_primary_password_label")></label>
                        </div>
                        <div class="col input-textbox">
                            <input type="text" id="WifiPrimaryPassword" name="WifiPrimaryPassword" value="<tmpl_var WifiPrimaryPassword>" <tmpl_if WifiPrimaryPasswordError>class="error"</tmpl_if> />
                        </div>
                        <tmpl_if WifiPrimaryPasswordError>
                            <div class="col inline_error">
                                <tmpl_var WifiPrimaryPasswordError>
                            </div>
                        </tmpl_if>
                    </div>

                    <div class="row clearfix">
                        <div class="col label-teeny">
                            &nbsp;
                        </div>
                        <div class="col input-textbox">
                            <div class="button_container clearfix">
                                <button type="button" class="secondary" id="GenerateNewPassword">
                                    <tmpl_var _("webui", "wifi_primary_generate_password_button")>
                                </button>
                            </div>
                        </div>
                    </div>

                    <p>
                        <tmpl_udf GET_PO_TEXT("wifi_primary_footer_note_text", gProductName)>
                    </p>

                </div>                
                    
                <div class="col-secondary bg-color">
                    <div class="row clearfix">
                        <div class="col label-long">
                            <!-- <div class="row clearfix"> -->
                                <div class="col insignia">
                                    <tmpl_if showToolTip>
                                        <div class="tooltip tooltip-help" id="sample" title="<tmpl_var _('webui', 'wifi_primary_show_ssid_help_text')>">
                                            <tmpl_var _("webui", "webui_inline_help_icon")>
                                        </div>
                                    </tmpl_if>
                                </div>
                                <div class="col motto">
                                    <label for="WifiPrimaryShowSsid"><tmpl_udf GET_PO_TEXT("wifi_primary_show_ssid_label", gProductName)></label>
                                </div>
                            <!-- </div> -->
                        </div>
                        <div class="col input-checkbox">
                            <input type="checkbox" id="WifiPrimaryShowSsid" name="WifiPrimaryShowSsid" <tmpl_if IN_SET(WifiPrimaryShowSsid, "on")>checked="checked"</tmpl_if> />
                        </div>
                        <tmpl_unless showToolTip>
                            <div class="col help">
                                <tmpl_udf GET_PO_TEXT("wifi_primary_show_ssid_help_text", gProductName)>
                            </div>
                        </tmpl_unless>
                    </div>

                    <div class="row clearfix">
                        <div class="col label-long">
                            <div class="col insignia">
                                <tmpl_if showToolTip>
                                    <div class="tooltip tooltip-help" id="sample" title="<tmpl_var _('webui', 'wifi_primary_show_password_help_text')>">
                                        <tmpl_var _("webui", "webui_inline_help_icon")>
                                    </div>
                                </tmpl_if>
                            </div>
                            <div class="col motto">
                                <label for="WifiPrimaryShowPassword"><tmpl_udf GET_PO_TEXT("wifi_primary_show_password_label", gProductName)></label>
                            </div>
                        </div>
                        <div class="col input-checkbox">
                            <input type="checkbox" id="WifiPrimaryShowPassword" name="WifiPrimaryShowPassword" <tmpl_if IN_SET(WifiPrimaryShowPassword, "on")>checked="checked"</tmpl_if> />
                        </div>
                        <tmpl_unless showToolTip>
                            <div class="col help">
                                <tmpl_udf GET_PO_TEXT("wifi_primary_show_password_help_text", gProductName)>
                            </div>
                        </tmpl_unless>
                    </div>

                    <div class="row clearfix">
                        <div class="col label-long">
                            <div class="col insignia">
                                <tmpl_if showToolTip>
                                    <div class="tooltip tooltip-help" id="sample" title="<tmpl_var _('webui', 'wifi_primary_broadcast_ssid_help_text')>">
                                        <tmpl_var _("webui", "webui_inline_help_icon")>
                                    </div>
                                </tmpl_if>
                            </div>
                            <div class="col motto">
                                <label for="WifiPrimaryBroadcastSsid"><tmpl_var _("webui", "wifi_primary_broadcast_ssid_label")></label>
                            </div>
                        </div>
                        <div class="col input-checkbox">
                            <input type="checkbox" id="WifiPrimaryBroadcastSsid" name="WifiPrimaryBroadcastSsid" <tmpl_if IN_SET(WifiPrimaryBroadcastSsid, "on")>checked="checked"</tmpl_if> />
                        </div>
                        <tmpl_unless showToolTip>
                            <div class="col help">
                                <tmpl_var _("webui", "wifi_primary_broadcast_ssid_help_text")>
                            </div>
                        </tmpl_unless>
                    </div>

                    <div class="row clearfix">
                        <div class="col label-long">
                            <div class="col insignia">
                                <tmpl_if showToolTip>
                                    <div class="tooltip tooltip-help" id="sample" title="<tmpl_udf GET_PO_TEXT("wifi_primary_wps_help_text", gProductName)>">
                                        <tmpl_var _("webui", "webui_inline_help_icon")>
                                    </div>
                                </tmpl_if>
                            </div>
                            <div class="col motto">
                                <label for="WifiPrimaryWpsEnabled"><tmpl_var _("webui", "wifi_primary_wps_label")></label>
                            </div>
                        </div>
                        <div class="col input-checkbox">
                            <input type="checkbox" id="WifiPrimaryWpsEnabled" name="WifiPrimaryWpsEnabled" <tmpl_if IN_SET(WifiPrimaryWpsEnabled, "on")>checked="checked"</tmpl_if> />
                        </div>
                        <tmpl_unless showToolTip>
                            <div class="col help">
                                <tmpl_udf GET_PO_TEXT("wifi_primary_wps_help_text", gProductName)>
                            </div>
                        </tmpl_unless>
                    </div>

                    <div class="row clearfix">
                        <div class="col label-long">
                            <div class="col insignia">
                                <tmpl_if showToolTip>
                                    <div class="tooltip tooltip-help" id="sample" title="<tmpl_var _('webui', 'wifi_primary_privacy_help_text')>">
                                        <tmpl_var _("webui", "webui_inline_help_icon")>
                                    </div>
                                </tmpl_if>
                            </div>
                            <div class="col motto">
                                <label for="WifiPrimaryPrivacyEnabled"><tmpl_var _("webui", "wifi_primary_privacy_label")></label>
                            </div>
                        </div>
                        <div class="col input-checkbox">
                            <input type="checkbox" id="WifiPrimaryPrivacyEnabled" name="WifiPrimaryPrivacyEnabled" <tmpl_if IN_SET(WifiPrimaryPrivacyEnabled, "on")>checked="checked"</tmpl_if> />
                        </div>
                        <tmpl_unless showToolTip>
                            <div class="col help">
                                <tmpl_var _("webui", "wifi_primary_privacy_help_text")>
                            </div>
                        </tmpl_unless>    
                    </div>
                </div>
                
            </div>
        </div>

        <div class="button_container clearfix">
            <button type="submit" class="primary" <tmpl_if isLocked>disabled="disabled"</tmpl_if>>
                <tmpl_var _("webui", "webui_save_button")>
            </button>
        </div>
    </form>

</tmpl_if>
