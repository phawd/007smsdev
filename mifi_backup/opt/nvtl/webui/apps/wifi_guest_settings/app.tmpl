<tmpl_if isHidden>
    <div class="notification app error">
        <tmpl_var _("webui", "webui_app_hidden_text")>
    </div>
<tmpl_else>
    <script type="text/javascript">
        var previousSecurityOption = parseInt("<tmpl_var WifiGuestSecurity>");
        var previousPassword = "<tmpl_var WifiGuestPassword>";

        $(function()
        {
            if ($("#WifiGuestSecurity").val() == 0) {
                $("#WifiGuestPassword").val("");
                $("#WifiGuestPassword").prop("disabled", true);
                $("#GenerateNewPassword").prop("disabled", true);
                if (jQuery.uniform) $.uniform.update("#WifiGuestPassword", "#GenerateNewPassword");
            }

            $("#WifiGuestSecurity").focus(function() {
                previousSecurityOption = $("#WifiGuestSecurity").val();
            }).change(function() {
                var securityType = $("#WifiGuestSecurity").val();

                <tmpl_if ShowWifiSecurityNone>
                    if (securityType == 0) {                        
                        showNoSecurityConfirmation(previousSecurityOption);
                    } else {
                        $("#WifiGuestPassword").prop("disabled", false);
                        $("#GenerateNewPassword").prop("disabled", false);
                        if (jQuery.uniform) $.uniform.update("#WifiGuestPassword", "#GenerateNewPassword");
                    }
                </tmpl_if>

            });

            $("#GenerateNewPassword").on("click", function() {
                generateNewPassword();
            });

            $("#WifiGuestPrivacyEnabled").on("change", function() {
                if ($("#WifiGuestPrivacyEnabled").is(":checked")) {
                    showWarning("<tmpl_var _("webui", "wifi_guest_privacy_warning_text")>");                    
                }
            });

        });

        function generateNewPassword() {
            var url = "<tmpl_udf GET_URI('wifi_guest_settings_generate_password')>";

            $.ajax({
                url : url,
                type : "GET",
                success: function(data) {
                    previousPassword = $("#WifiGuestPassword").val();
                    $("#WifiGuestPassword").val(data["GeneratedPassword"]);
                    if (jQuery.uniform) $.uniform.update("#WifiGuestPassword");
                },
                error : function(xhr, textStatus, errorThrown) {
                    // If auth session has ended, force a new login with a fresh GET.
                    if( (xhr.status == 401) || (xhr.status == 403) || (xhr.status == 406) ) {
                        window.location.replace(window.location.href);
                    } else  {
                        return false;
                    }
                }
            });          
        }

        function showWarning(text) {            
            modalPopup.createWindow('<tmpl_var _("webui", "webui_app_warning_title")>', '<p>'+text+'</p>', 430, 250, [{
                text : '<tmpl_var _("webui", "webui_modal_ok_button")>',
                className : "primary",
                trigger : function() {
                    // do nothing
                }
            }], null, function() {
                // do nothing
            });
        }

        function showNoSecurityConfirmation(previousSecurityOption) {
            modalPopup.createWindow('<tmpl_var _("webui", "webui_modal_title")>', '<p><tmpl_udf GET_PO_TEXT("wifi_guest_security_none_warning_text", gProductName)></p>', 430, 250, [{
                    text : '<tmpl_var _("webui", "webui_modal_cancel_button")>',
                    className : "cancel",
                    trigger : function() {
                        $("#WifiGuestSecurity").val(previousSecurityOption);
                        if (jQuery.uniform) $.uniform.update("#WifiGuestSecurity");
                    }
            }, {
                    text : '<tmpl_var _("webui", "webui_modal_confirm_button")>',
                    className : "primary",
                    trigger : function() {
                        $("#WifiGuestPassword").val("");
                        $("#WifiGuestPassword").prop("disabled", true);
                        $("#GenerateNewPassword").prop("disabled", true);
                        if (jQuery.uniform) $.uniform.update("#WifiGuestPassword","#GenerateNewPassword");
                    }
            }], null, function(){
                $("#WifiGuestSecurity").val(previousSecurityOption);
                if (jQuery.uniform) $.uniform.update("#WifiGuestSecurity");
            });
        }

    </script>

    <tmpl_if isLocked>
        <div class="notification app error">
            <tmpl_var _("webui", "webui_app_locked_text")>
        </div>
    </tmpl_if>

    <tmpl_if errorCount>
        <div class="notification app error">
            <div class="notification_inner">
                <tmpl_var _("webui", "webui_save_code_failed_text")>
            </div>
        </div>
    </tmpl_if>

    <tmpl_if gPostSuccess>
        <div class="notification app success">
            <div class="notification_inner">
                <tmpl_var _("webui", "webui_save_code_success_text")>
            </div>
        </div>
    </tmpl_if>

    <p>
        <tmpl_udf GET_PO_TEXT("wifi_guest_intro_text", gProductName)>
    </p>

    <form id="wifi_guest_settings_form" method="POST" action="<tmpl_udf GET_URI('wifi_guest_settings')>" >

            <div class="table">
                <div class="row clearfix">
                    <div class="col-primary">
                        <div class="row clearfix">
                            <div class="col label-teeny">
                                <label for="WifiGuestSsid"><tmpl_var _("webui", "wifi_guest_ssid_label")></label>
                            </div>
                            <div class="col input-textbox">
                                <input type="text" id="WifiGuestSsid" name="WifiGuestSsid" value="<tmpl_var WifiGuestSsid>" <tmpl_if WifiGuestSsidError>class="error"</tmpl_if> />
                            </div>
                            <tmpl_if WifiGuestSsidError>
                                <div class="col inline_error">
                                    <tmpl_var WifiGuestSsidError>
                                </div>
                            </tmpl_if>
                        </div>

                        <div class="row clearfix">
                            <div class="col label-teeny">
                                <label for="WifiGuestSecurity"><tmpl_var _("webui", "wifi_guest_security_label")></label>
                            </div>
                            <div class="col input-textbox">
                                <select id="WifiGuestSecurity" name="WifiGuestSecurity">
                                    <tmpl_include "wifi_security_options.tmpl">
                                </select>
                            </div>
                        </div>

                        <div class="row clearfix">
                            <div class="col label-teeny">
                                <label for="WifiGuestPassword"><tmpl_var _("webui", "wifi_guest_password_label")></label>
                            </div>
                            <div class="col input-textbox">
                                <input type="text" id="WifiGuestPassword" name="WifiGuestPassword" value="<tmpl_var WifiGuestPassword>" <tmpl_if WifiGuestPasswordError>class="error"</tmpl_if> />
                            </div>
                            <tmpl_if WifiGuestPasswordError>
                                <div class="col inline_error">
                                    <tmpl_var WifiGuestPasswordError>
                                </div>
                            </tmpl_if>
                        </div>

                        <div class="row clearfix">
                             <div class="col label-teeny">
                                &nbsp;
                            </div>
                            <div class="col input-textbox">
                                <div class="button_container clearfix">
                                    <button type="button" class="secondary" id="GenerateNewPassword">
                                        <tmpl_var _("webui", "wifi_guest_generate_password_button")>
                                    </button>
                                </div>
                            </div>
                        </div>
                    
                        <p>
                            <tmpl_udf GET_PO_TEXT("wifi_guest_footer_note_text", gProductName)>
                        </p>

                    </div>                
                    
                    <div class="col-secondary bg-color">
                        <div class="row clearfix">
                            <div class="col label-long">
                                <div class="col insignia">
                                    <tmpl_if showToolTip>
                                        <div class="tooltip tooltip-help" id="sample" title="<tmpl_var _('webui', 'wifi_guest_show_ssid_help_text')>">
                                            <tmpl_var _("webui", "webui_inline_help_icon")>
                                        </div>
                                    </tmpl_if>
                                </div>
                                <div class="col motto">
                                    <label for="WifiGuestShowSsid"><tmpl_udf GET_PO_TEXT("wifi_guest_show_ssid_label", gProductName)></label>
                                </div>
                            </div>
                            <div class="col input-checkbox">
                                <input type="checkbox" id="WifiGuestShowSsid" name="WifiGuestShowSsid" <tmpl_if IN_SET(WifiGuestShowSsid, "on")>checked="checked"</tmpl_if> />
                            </div>
                            <tmpl_unless showToolTip>
                                <div class="col help">
                                    <tmpl_udf GET_PO_TEXT("wifi_guest_show_ssid_help_text", gProductName)>
                                </div>
                            </tmpl_unless> 
                        </div>

                        <div class="row clearfix">
                            <div class="col label-long">
                                <div class="col insignia">
                                    <tmpl_if showToolTip>
                                        <div class="tooltip tooltip-help" id="sample" title="<tmpl_var _('webui', 'wifi_guest_show_password_help_text')>">
                                            <tmpl_var _("webui", "webui_inline_help_icon")>
                                        </div>
                                    </tmpl_if>
                                </div>
                                <div class="col motto">
                                    <label for="WifiGuestShowPassword"><tmpl_udf GET_PO_TEXT("wifi_guest_show_password_label", gProductName)></label>
                                </div>
                            </div>
                            <div class="col input-checkbox">
                                <input type="checkbox" id="WifiGuestShowPassword" name="WifiGuestShowPassword" <tmpl_if IN_SET(WifiGuestShowPassword, "on")>checked="checked"</tmpl_if> />
                            </div>
                            <tmpl_unless showToolTip>
                                <div class="col help">
                                    <tmpl_udf GET_PO_TEXT("wifi_guest_show_password_help_text", gProductName)>
                                </div>
                            </tmpl_unless> 
                        </div>

                        <div class="row clearfix">
                            <div class="col label-long">
                                <div class="col insignia">
                                    <tmpl_if showToolTip>
                                        <div class="tooltip tooltip-help" id="sample" title="<tmpl_udf GET_PO_TEXT("wifi_guest_wps_help_text", gProductName)>">
                                            <tmpl_var _("webui", "webui_inline_help_icon")>
                                        </div>
                                    </tmpl_if>
                                </div>
                                <div class="col motto">
                                    <label for="WifiGuestWpsEnabled"><tmpl_var _("webui", "wifi_guest_wps_label")></label>
                                </div>
                            </div>
                            <div class="col input-checkbox">
                                <input type="checkbox" id="WifiGuestWpsEnabled" name="WifiGuestWpsEnabled" <tmpl_if IN_SET(WifiGuestWpsEnabled, "on")>checked="checked"</tmpl_if> />
                            </div>
                            <tmpl_unless showToolTip>
                                <div class="col help">
                                    <tmpl_udf GET_PO_TEXT("wifi_guest_wps_help_text", gProductName)>
                                </div>
                            </tmpl_unless> 
                        </div>

                        <div class="row clearfix">
                            <div class="col label-long">
                                <div class="col insignia">
                                    <tmpl_if showToolTip>
                                        <div class="tooltip tooltip-help" id="sample" title="<tmpl_var _('webui', 'wifi_guest_privacy_help_text')>">
                                            <tmpl_var _("webui", "webui_inline_help_icon")>
                                        </div>
                                    </tmpl_if>
                                </div>
                                <div class="col motto">
                                    <label for="WifiGuestPrivacyEnabled"><tmpl_var _("webui", "wifi_guest_privacy_label")></label>
                                </div>
                            </div>
                            <div class="col input-checkbox">
                                <input type="checkbox" id="WifiGuestPrivacyEnabled" name="WifiGuestPrivacyEnabled" <tmpl_if IN_SET(WifiGuestPrivacyEnabled, "on")>checked="checked"</tmpl_if> />
                            </div>
                            <tmpl_unless showToolTip>
                                <div class="col help">
                                    <tmpl_var _("webui", "wifi_guest_privacy_help_text")>
                                </div>
                            </tmpl_unless> 
                        </div>
                    </div>
                </div>
            </div>

        <div class="button_container clearfix">
            <input type="hidden" name="gSecureToken" id="gSecureToken" value="<tmpl_var gSecureToken>" />
            <button type="submit" class="primary" <tmpl_if isLocked>disabled="disabled"</tmpl_if>>
                <tmpl_var _("webui", "webui_save_button")>
            </button>
        </div>
    </form>

</tmpl_if>
