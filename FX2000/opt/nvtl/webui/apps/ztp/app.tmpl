<script type="text/javascript">
/* <![CDATA[ */

	$(function()
	{
		var isUrl = false;
		var isIp = false;
		var pollingRate = 5000; // 5 seconds

		getZTPStatus();

		function url_ip_valid(url) {
        		//var regUrl = /^(((ht|f){1}(tp:[/][/]){1})|((www.){1}))[-a-zA-Z0-9@:%_\+.~#?&//=]+$/;
        		var regUrl = /([a-z0-9]+\.)*[a-z0-9]+\.[a-z]+/;
			if (regUrl.test(url) == false) {
			    if (ip_validate(url) == true)
				isIp = true;
			} else {
			    isUrl = true;
			}
		}

		function ip_validate(ipaddress) {
			if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(ipaddress)) {
		    		return (true);
			}
			return (false);
    		}

	
		function getZTPStatus() {
			$.ajax({
                        	url : "<tmpl_udf GET_URI('ztp_status_retrieve')>",
                        	type : "GET",
				dataType : "json",
				success : function(data) {
					// Let's give some time before first checking usage
					if (data) {
						if(data.statusUpdate) {
			                                $("#urlAddressError").show();
							if (data.status == 23 || data.status == 24){
								$("#urlAddressError").removeClass("inline_error");
								$("#urlAddressError").addClass("notification app success");
							}
							$("#urlAddressErrorText").text(data.statusUpdate);
						}
					}
				},
				error : function(xhr, textStatus, errorThrown) {
					//something went wrong with the trigger, simply revert to proper message
				},
				complete : function() {
			                    setTimeout(getZTPStatus, pollingRate);
	            		}
			});
		}

		$("#urlAddressError").hide();

		$("#saveChanges").click(function() {
			var urlAddress = $("#urlAddress").val();
			var sslStatus = $("#protocolStatus").val();
			url_ip_valid(urlAddress);                                                                               
			if ((isUrl == false) && (isIp == false)) {                                                              
                                $("#urlAddressError").show();
				$("#urlAddressErrorText").text('<tmpl_var _("webui","ztp_invalid_ip_url_error_text")>');
				return false;                                                                                   
                        } else {                                                                                                
                                $.ajax({                                                                                        
                                        url : "<tmpl_udf GET_URI('ztp_store_ip_url')>",                                          
                                        type : "POST",                                                                          
                                        data : { 
                                                sslStatus : sslStatus,
						urlAddress : urlAddress,
		                                gSecureToken : "<tmpl_var gSecureToken>"                                        
		                        },                                                                                      
	                                dataType : "json",                                                             
	                                success : function(data, textStatus, xhr){                                     
	                                },                                                                             
	                                error : function(xhr, textStatus, errorThrown){                                
	                                },                                                                             
                                        complete : function(xhr, textStatus){                                          
                                        }                                                                              
                                });                                                                                    
                        }
		});
		
	});

/* ]]> */
</script>

<tmpl_if errorCount>
	<div class="notification app error">
		<div class="notification_inner">
			<tmpl_var _("webui", "webui_save_code_failed_text")>
		</div>
	</div>
</tmpl_if>

<tmpl_if gPostSuccess>
	<div class="notification app success">
		<div class="notification_inner">
			<tmpl_var _("webui", "webui_ztp_save_code_success_text")>
		</div>
	</div>
</tmpl_if>

<tmpl_if IN_SET(wrongFile, "true")>
	<div class="notification app error">
		<div class="notification_inner">
			<tmpl_var _("webui", "webui_ztp_validation_error_text")>
		</div>
	</div>
</tmpl_if>

<h2 class="sectionHead"><tmpl_udf GET_PO_TEXT("ztp_header", gProductNumber, gProductName)></h2>

<p id="note" class="note">
	<tmpl_var _("webui", "webui_ztp_header_text")>
</p>
<form id="ztpForm" method="POST" action="<tmpl_udf GET_URI('ztp')>" enctype="multipart/form-data">
	<fieldset id="ztp_field">
		<input type="hidden" id="gSecureToken" name="gSecureToken" value="<tmpl_var gSecureToken>" />
		<input type="hidden" id="isRequestSent" name="isRequestSent" value="<tmpl_var isRequestSent>" />

		<div id="uploadInput">
			<h3 class="sectionHead"><tmpl_var _("webui", "ztp_subheader")></h3>
			<div class="table">
				<!-- <div class="form-group clearfix">
					<div id="ztpUpdateLabel" class="label">
						<label><tmpl_var _("webui", "ztp_file_select_label")></label>
					</div>
					<div class="input filetype">
						<input type="file" name="ztpUpdateFile" id="ztpUpdateFile"<tmpl_if ztpUpdateFileError> class="error"</tmpl_if> />
					</div>
					<tmpl_if ztpUpdateFileError>
						<div class="inline_error">
							<tmpl_var ztpUpdateFileError>
						</div>
					</tmpl_if>					
				  <div class="clearfix"></div>   
				</div> --><!-- /.row -->
				<div class="form-group">                 
                       			<label for="protocolStatus"><tmpl_var _("webui", "webui_ztp_protocol_text")></label>
                       			<select name="protocolStatus" id="protocolStatus">                                            
                                       		<tmpl_include "ztp_protocol_options.tmpl">                 
                               		</select>                   
               			</div>
				<div class="form-group">                                                  
		                	<label for="urlAddress"><tmpl_var _("webui", "webui_ztp_URL_text")></label>                                                                                                        
		                        <input type="text" name="urlAddress" id="urlAddress" value="<tmpl_var urlAddress>" <tmpl_if urlAddressError>class="error"</tmpl_if> /> 
					<div class="inline_error" id="urlAddressError">
                                        	<label id="urlAddressErrorText"></label>
                                	</div>
		                        <tmpl_if urlAddressError>
		                               	<div class="col inline_error">
		                               		<tmpl_var urlAddressError>
		                               	</div>
		                        </tmpl_if>                                                                    
		        	</div>
				<div class="button_container align-field clearfix">
					<button type="submit" id="saveChanges" class="primary">
						<tmpl_var _("webui", "webui_save_button")> 
					</button>
				</div>
			</div><!-- /.table -->
		</div>


		<p id="ztpUpdateFileProcessingMsg" class="loading" style="display:none;">
			<tmpl_var _("webui", "ztp_processing_text")>
		</p>
	</fieldset>

   
</form>
