<tmpl_if isHidden>
	<div class="notification app error">
		<tmpl_var _("webui", "webui_app_hidden_text")>
<tmpl_else>
	<tmpl_if inAirplaneMode>
		<tmpl_var _("webui", "gps_status_not_available_in_airplane_mode_error_text")>
	<tmpl_else>
		<tmpl_if haveInternet>
			<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
		</tmpl_if>
		<script type="text/javascript">
			/* <![CDATA[ */
			var autoChange, gpsInterval, GPSEnable;
			var defaultLat = 32.8954;
			var defaultLong = -117.201;
			var mapStatus = "";
			var pollingRate = 10000;
			var isPolling = false;			
			$(function()
				GPSEnable = $("#GPSEnable:checkbox");
				 <tmpl_if gpsIsOff>
				 	$(".toggleGPS").hide();
				 </tmpl_if>
				//Initialize gps values, start polling
				<tmpl_unless gpsIsOff>
					isPolling = true;
					updateGpsStatus();
					gpsInterval = window.setInterval(updateGpsStatus, pollingRate);
				</tmpl_unless>
				//Intialize our fancy toggle checkboxes
				if(jQuery.fn.slideButton) {
					// GPS toggle
					GPSEnable.slideButton({
						change : function($input) {
							<tmpl_if GPSEnableShow>
								if($input.is(":checked") ){
									if("<tmpl_var GPSAgreementShow>" === "1"){
										showAgreement($input);
									} else {
										postGPSEnable($input);
									}
								} else {
									postGPSEnable($input);
								}
							</tmpl_if>
					});
					<tmpl_if GPSTurnOffConditionShow>
							$("#GPSTurnOffCondition").slideButton("ajaxToggle", {
								checkUrl : "<tmpl_udf GET_URI('gps_status_startupstatusoff')>",
								uncheckUrl : "<tmpl_udf GET_URI('gps_status_startupstatuson')>",
								data : {
									gSecureToken : "<tmpl_var gSecureToken>"
								}
							});
					</tmpl_if>
					<tmpl_if GPSOverWiFiEnableShow>
						<tmpl_unless GPSOverWiFiEnableLocked>
							$("#GPSOverWiFiEnable").slideButton("ajaxToggle", {
								checkUrl : "<tmpl_udf GET_URI('gps_status_gpsoverwifienable')>",
								uncheckUrl : "<tmpl_udf GET_URI('gps_status_gpsoverwifidisable')>",
								data : {
									gSecureToken : "<tmpl_var gSecureToken>"
								}
							});
						</tmpl_unless>
					</tmpl_if>					
				}			
		<tmpl_if GPSEnableShow>
			<tmpl_unless GPSEnableLocked>
				function showAgreement($input)
					var title = '<tmpl_var _("webui", "gps_status_agreement_title")>';
					var content = "<p><tmpl_udf GET_PO_TEXT('gps_status_agreement_text1', gProductNumber)></p> \
						<p><tmpl_udf GET_PO_TEXT('gps_status_agreement_text2', gProductNumber)></p>\
						<p><tmpl_udf GET_PO_TEXT('gps_status_agreement_text3', gProductNumber)></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text4')></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text5')></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text6')></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text7')></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text8')></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text9')></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text10')></p> \
						<p><tmpl_var _('webui', 'gps_status_agreement_text11')></p>";
					var width = 800;
					var height = 500;
					var btns;
					var open;
					var close;
					if (typeof $input !== "undefined") {
						content = content + '<p><tmpl_var _("webui", "gps_status_agreement_action_text")></p>';
						btns = [
							{
								text: '<tmpl_var _("webui", "gps_status_agreement_no_button")>',
								className: "cancel",
								trigger : function() {
									$input.slideButton("undo");
									$input.slideButton("removeLoader");
								}
							},
							{
								text:'<tmpl_var _("webui", "gps_status_agreement_yes_button")>',
								className:"primary",
								trigger : function() {
									postGPSEnable($input);
								}
							}
						];
						close = function() {
							$input.slideButton("undo");
							$input.slideButton("removeLoader");
						};
					modalPopup.createWindow(title, content, width, height, btns, open, close);
				function postGPSEnable($input)
					var url = ($input.is(":checked")) ? "<tmpl_udf GET_URI('gps_status_enablegps')>" : "<tmpl_udf GET_URI('gps_status_disablegps')>";
					//prevent calling server when the server is who updated
					if (autoChange != true) {
						if (jQuery.fn.slideButton) $input.slideButton("addLoader");
						$.ajax({
							url : url,
							type : "POST",
							data : {
								gSecureToken : "<tmpl_var gSecureToken>"
							},
							dataType : "json",
							success : function(data, textStatus, xhr) {
								// If no network connected, success event still occurs.
								// We need to implicitly see an xhr.status greater than 0 to know we've actually made contact.
								if ( (xhr.readyState == 4 ) && (xhr.status == 0) ) {
									if (jQuery.fn.slideButton) $input.slideButton("undo");
								}
							},
							error : function(xhr, textStatus, errorThrown) {
								if (jQuery.fn.slideButton) $input.slideButton("undo");
								// If auth session has ended, force a new login with a fresh GET.
								if( (xhr.status == 401) || (xhr.status == 403) || (xhr.status == 406) ) window.location.replace(window.location.href);
							},
							complete : function(xhr, textStatus) {
								if(jQuery.statusBar) $.statusBar("refresh");
								if ($input.is(":checked")) {
									mapInit();
									if(isPolling === false) {
										isPolling = true;
										updateGpsStatus();
										gpsInterval = window.setInterval(updateGpsStatus, pollingRate);
									}
								} else {
									mapHide();
								}
								if (jQuery.fn.slideButton) $input.slideButton("removeLoader");
							}
						});
					} else {
						autoChange = false;
						if(jQuery.statusBar) $.statusBar("refresh");
						if ($input.is(":checked")) {
							mapInit();
						} else {
							mapHide();
			</tmpl_unless>
		</tmpl_if>
		<tmpl_if GPSDownloadDriversShow>
			<tmpl_unless GPSDownloadDriversLocked>
				function showDriverDownloadDialog() {
					var title = '<tmpl_var _("webui", "gps_status_driver_download_help_title")>';
					var content = "<div id='help_wrapper'><div><h1><tmpl_var _('webui', 'gps_status_driver_download_header_text')></h1> \
						<h2><tmpl_var _('webui', 'gps_status_driver_dowload_overview_header_text')></h2> \
						<p><tmpl_var _('webui', 'gps_status_driver_download_overview_text1')><em><tmpl_var _('webui', 'gps_status_driver_download_gps_over_wifi_text')></em><tmpl_var _('webui', 'gps_status_driver_download_overview_text2')></p>\
						<p><tmpl_var _('webui', 'gps_status_driver_download_overview_text3')></p> \
						<h2><tmpl_var _('webui', 'gps_status_driver_download_available_drivers_header_text')></h2> \
						<h3><a href='<tmpl_udf GET_EXTERNAL_URI('provider_gps_windows_driver_downloader')>'><tmpl_var _('webui', 'gps_status_driver_download_for_windows_text')></a></h3> \
						<p><tmpl_var _('webui', 'gps_status_driver_download_note_for_windows_driver_text1')><em><tmpl_var _('webui', 'gps_status_driver_download_gps_over_wifi_text')></em><tmpl_var _('webui', 'gps_status_driver_download_note_for_windows_driver_text2')></p></div></div>";
					var width = 800;
					var height = 500;
					modalPopup.createWindow(title, content, width, height);
			</tmpl_unless>
		</tmpl_if>
		//Updates GPS Coordinates and Status and modifies DOM/UI accordingly
		function updateGpsStatus()
			$.ajax({
				url : "/gps/status/",
				type : "GET",
				dataType : "json",
				success : function(data) {
					//if gps is not off
					if (data.gpsIsOff != 1) {
						//if gps is fixed
						if (data.gpsStatus === 2 ) { //SYS_GPS_STATUS_FIX_AVAILABLE = 2
							if (mapStatus !== "fixed") {//and we're not already set to fixed
								setMapFixed();
							}
							//update ui based on gps status
							$("#gpsStatusAltitude").text(data.gpsStatusAltitude);
							if(data.gpsStatus === 1 ) {// SYS_GPS_STATUS_SEARCHING = 1
								var StatusHeadingTitle = $("<i/>").html("<tmpl_var _('webui', 'gps_status_aquiring_position_text')>").text();
								$("div#gps_panel fieldset.first h2.tableHeader").text(StatusHeadingTitle);
							} else if (data.gpsStatus === 2 ) { //SYS_GPS_STATUS_FIX_AVAILABLE = 2
								var StatusHeadingTitle = $("<i/>").html('<tmpl_var _("webui", "gps_status_current_position_label")>').text();
								$("div#gps_panel fieldset.first h2.tableHeader").text(StatusHeadingTitle);
							}
							$("#gpsStatusHorizontalVelocity").text(data.gpsStatusHorizontalVelocity);
							$("#gpsStatusLatitude").text(data.gpsStatusLatitude);
							$("#gpsStatusLongitude").text(data.gpsStatusLongitude);
							$("#gpsStatusUncertainty").text(data.gpsStatusUncertainty);
							$("#gpsStatusFixType").text(data.gpsStatusFixType);
							$("#gpsStatusTimestamp").text(data.gpsStatusTimestamp);
							$("#gpsStatusSatelliteCount").text(data.gpsStatusSatelliteCount);
					//If gps is off and we're not already set to off
					} else if (data.gpsStatus === 0 && mapStatus !== "off") { //SYS_GPS_STATUS_NOT_SEARCHING = 0
						if (GPSEnable.prop("checked") === true) {
							autoChange = true;
							// Set the GPSEnable to "unchecked" and refresh the GPSEnable
							if (jQuery.fn.slideButton) GPSEnable.slideButton("toggle");
				error : function(xhr, textStatus, errorThrown) {
					// If auth session has ended, force a new login with a fresh GET.
					if( (xhr.status == 401) || (xhr.status == 403) || (xhr.status == 406) ) window.location.replace(window.location.href);
		//Initialize map using default coordinates and call to update gps status.
		function mapInit()
			$("#gps_panel").show();
			$(".toggleGPS").show();
			$("#map_status").html('<tmpl_var _("webui", "gps_status_searching_text")>').removeClass("fixed").addClass("loading");
			mapStatus = "searching";
		//Set DOM Elements to fixed styles
		function setMapFixed()
			$("#gps_table").show();
			$("#map_status").html('<tmpl_var _("webui", "gps_status_acquired_text")>').removeClass("loading").addClass("fixed");
			mapStatus = "fixed";
		//Hide Map and reset map and marker
		function mapHide()
			mapStatus = "off";
			$("#map_status").html("");
			$(".toggleGPS").hide();
		/* ]]> */
		</script>
		<tmpl_if isLocked>
				<div class="notification app error">
			<tmpl_var _("webui", "webui_app_locked_text")>
				</div>
		</tmpl_if>
		<tmpl_if errorCount>
		<div class="notification app error">
			<div class="notification_inner">
					<tmpl_var _("webui", "webui_save_code_failed_text")>
				</p>
			</div>
		</div>
		</tmpl_if>
		<tmpl_if gPostSuccess>
		<div class="notification app success">
			<div class="notification_inner">
					<tmpl_var _("webui", "webui_save_code_success_text")>
				</p>
			</div>
		</div>
		</tmpl_if>
		<p class="note">
			<tmpl_var _("webui", "gps_status_intro_label")>
		<div class="table">
			<h2 class="sectionHead" id="obsent"><tmpl_var _("webui", "gps_status_gps_settings_sub_heading_text")></h2>			
			<div class="row clearfix">
					<tmpl_var _("webui", "gps_status_enable_help_text")>
				</p>
			</div>
			<div id="gps_panel">
				<div class="row clearfix">					
					<div class="petite">
						<tmpl_if GPSEnableShow>
								<div class="toggleSettingContainer align-field">
									<div class="form-group">
										<label for="GPSEnable"><tmpl_var _("webui", "gps_status_enable_label")></label>
										<div class="toggle">
											<input class="toggleSwitchCheckbox" type="checkbox" id="GPSEnable" name="GPSEnable"<tmpl_unless gpsIsOff> checked="checked"</tmpl_unless> <tmpl_if GPSEnableLocked> disabled="disabled" </tmpl_if> <tmpl_if isLocked>disabled="disabled"</tmpl_if> />
										</div>
									</div>
								</div><!--/.toggleSettingContainer-->
						</tmpl_if>
						<tmpl_if GPSTurnOffConditionShow>
								<div class="toggleSettingContainer align-field toggleGPS">
									<div class="form-group">
										<label for="GPSTurnOffCondition"><tmpl_udf GET_PO_TEXT("gps_status_startup_state_label", gProductNumber)></label>
										<div class="toggle">
											<input class="toggleSwitchChcekbox" type="checkbox" id="GPSTurnOffCondition" name="GPSTurnOffCondition" <tmpl_if IN_SET(gpsStartupState, 0, "0")> checked="checked"</tmpl_if><tmpl_if GPSTurnOffConditionLocked> disabled="disabled" </tmpl_if> />
										</div>
									</div>
								</div><!--/.toggleSettingContainer-->
						</tmpl_if>
						<tmpl_if GPSOverWiFiEnableShow>
								<div class="toggleSettingContainer align-field toggleGPS">
									<div class="form-group">									
										<label for="GPSOverWiFiEnable">
											<tmpl_var _("webui", "gps_status_gps_over_wifi_label")>
										</label>															
										<div class="toggle">
											<input class="toggleSwitchCheckbox" type="checkbox" id="GPSOverWiFiEnable" name="GPSOverWiFiEnable"  <tmpl_if GPSOverWiFiEnable> checked="checked"</tmpl_if><tmpl_if GPSOverWiFiEnableLocked> disabled="disabled"</tmpl_if> <tmpl_if isLocked>disabled="disabled"</tmpl_if> />
										</div>
									</div>
								</div><!--/.toggleSettingContainer-->							
						</tmpl_if>
						<tmpl_if GPSPortNumberShow>
							<form method="POST" id="gpsWiFi" action="<tmpl_udf GET_URI('gps')>">
								<div class="form-group toggleGPS">
									<div class="label">
										<label for="GPSPortNumber" class="GPSPortNumber">
											<tmpl_var _("webui", "gps_status_port_number_label")>
										</label>
									</div>
									<div class="input">
										<input type="text" size="5" name="GPSPortNumber" id="GPSPortNumber" maxlength="5" value="<tmpl_var GPSPortNumber>"<tmpl_if GPSPortNumberLocked> disabled="disabled"</tmpl_if><tmpl_if GPSPortNumberError> class="error"</tmpl_if> />
									</div>
									<tmpl_if GPSPortNumberError>
										<div class="inline_error"><tmpl_var GPSPortNumberError></div>
									</tmpl_if>
								</div>
								<div class="button_container clearfix align-field toggleGPS">
									<input type="hidden" name="gSecureToken" id="gSecureToken" value="<tmpl_var gSecureToken>" />
									<button type="submit" class="btn primary" id="GPSSaveChanges" <tmpl_if isLocked>disabled="disabled"</tmpl_if> >
										<tmpl_var _("webui", "webui_save_button")>
									</button>
								</div>
							</form>
						</tmpl_if>
					</div>
					<div class="regular toggleGPS">
						<div class="row clearfix toggleGPS">
							<tmpl_if GPSDownloadDriversShow>
								<h2 class="sectionHead"><tmpl_var _("webui", "gps_status_gps_driver_sub_heading_text")></h2>
								<p><tmpl_udf GET_PO_TEXT("gps_status_gps_over_wifi_text", gProductNumber)></p>
								<div class="row clearfix">
									<fieldset id="downloadGpsOverDriver">
										<div class="button_container align-field clearfix">
		                                		<button id="downloadGpsDriver" type="button" class="btn primary <tmpl_if downloadGpsDriverLocked> disabled" <tmpl_else>" onclick="showDriverDownloadDialog();"</tmpl_if> <tmpl_if isLocked> disabled="disabled"</tmpl_if> <tmpl_if GPSDownloadDriversLocked> disabled="disabled"</tmpl_if>><tmpl_var _("webui", "gps_status_wifi_driver_download_link")></button>
										</div>
									</fieldset>
								</div>
							</tmpl_if>
							<tmpl_if GPSCurrentLocationShow>
								<h2 class="sectionHead">
									<tmpl_var _("webui", "gps_status_current_location_label")>
								</h2>
							</tmpl_if>
							<fieldset>
								<div class="row clearfix">
									<div class="col textCol" id="map_status"><tmpl_var _("webui", "gps_status_searching_text")></div>
								</div>
								<div id="gps_table" class="table clearfix" <tmpl_if gpsIsOff>style="display:none;"</tmpl_if> <tmpl_if IN_SET(gpsStatus, 1)>style="display:none;"</tmpl_if>>
									<br>
									<div class="row clearfix">
										<div class="col label"><tmpl_var _("webui", "gps_status_latitude_label")></div>
										<div class="col textCol" id="gpsStatusLatitude"><tmpl_var gpsStatusLatitude></div>
									</div><!-- /.row -->
									<div class="row clearfix">
										<div class="col label"><tmpl_var _("webui", "gps_status_altitude_label")></div>
										<div class="col textCol" id="gpsStatusAltitude"><tmpl_var gpsStatusAltitude></div>
									</div><!-- /.row -->
									<div class="row clearfix">
										<div class="col label"><tmpl_var _("webui", "gps_status_longitude_label")></div>
										<div class="col textCol" id="gpsStatusLongitude"><tmpl_var gpsStatusLongitude></div>
									</div><!-- /.row -->
									<div class="row clearfix">
										<div class="col label"><tmpl_var _("webui", "gps_status_accuracy_label")></div>
										<div class="col textCol" id="gpsStatusUncertainty"><tmpl_var gpsStatusUncertainty></div>
									</div><!-- /.row -->							
								</div><!-- /.table -->
							</fieldset>
						</div>	
					</div>
				</div>
			</div>
		</div>	<!-- .table -->
	</tmpl_if><!-- /inAirplaneMode -->
</tmpl_if><!-- isHidden -->
