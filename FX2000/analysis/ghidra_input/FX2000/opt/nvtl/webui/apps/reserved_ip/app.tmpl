<tmpl_if isHidden>
	<div class="notification app error">
		<tmpl_var _("webui", "webui_app_hidden_text")>
	</div>
<tmpl_else>
        <script type="text/javascript">
                /* <![CDATA[ */

                if ("<tmpl_var reboot>" === "true") {
                        window.location = "<tmpl_udf GET_URI('restarting')>";
                }

                var MaxAllowedDevices = "<tmpl_var MaxAllowedDevices>";
                var MaxAllowedDevicesPerSave = "<tmpl_var MaxAllowedDevicesPerSave>";

                $(function()
                {
                        var addButtonClickCount = 0;

                        if($("tr.reserveIPInfoRow").length == 0) {
                            $("#saveChanges").hide();
                        }

                        if($("tr.reserveIPInfoRow").length >= MaxAllowedDevices) {
                                $("#AddReservedIP").prop("disabled", true);
                        }

                        <tmpl_if ReservedIPAddDeviceShow>
                                <tmpl_unless ReservedIPAddDeviceLocked>
                                //Add a new reserved IP
                                        $("#AddReservedIP").on("click", function() {
                                                addButtonClickCount = addButtonClickCount + 1;
                                                $("#ReservedIPAddrTable thead").show();
                                                $("#ReservedIPAddrTableNoRows").hide();
                                                var numReservedIPs = $("tr.reserveIPInfoRow").length;
                                                var rowID = numReservedIPs + 1;
                                                var Row = $('<tr id="reserveIPInfoRow' + rowID + '" class="dyn reserveIPInfoRow"></tr>');                
                                                <tmpl_if ShowDeviceType>
                                                        Row.append('<td class="deviceType" id="deviceTypeIndex' + rowID + '">' +
                                                                '<select class="deviceType" name="deviceTypeIndex' + rowID + '" id="devicTypeIndex' + rowID + '">' + <tmpl_include "supported_devices_options.tmpl"> + '</select></td>');
                                                </tmpl_if>    
                                                Row.append('<td class="deviceName">' +
                                                        '<input type="text" value="" name="deviceNameIndex' + rowID + '" maxlength="256" id="deviceNameIndex' + rowID + '" class="reservedIpDeviceName  text" /></td>');
                                                Row.append('<td class="macAddressColumn">' +
                                                        '<input type="text" value="" name="macAddressIndex' + rowID + '" id="macAddressIndex' + rowID + '" /></td>');
                                                Row.append('<td class="ipaddress current">' +
                                                        '<div name="currentIPAddressIndex' + rowID + '" id="currentIPAddressIndex' + rowID + '" /></td>');
                                                Row.append('<td class="checkbox">' +
                                                        '<input type="checkbox" id="reservedIpIndex' + rowID + '" name="reservedIpIndex' + rowID + '" checked="checked" onchange="handleReserveIpChange(<tmpl_var (item.__index__ + 1)>)" /></td>');
                                                Row.append('<td class="ipaddress reserved">' +
                                                        '<input type="text" value="" name="reservedIPAddressIndex' + rowID + '" id="reservedIPAddressIndex' + rowID + '" /></td>');

                                                // Add uniform to Select And Checkbox.
                                                if (jQuery.uniform) {
                                                        // This is for uniform 1 and uniform 2 compatibility.
                                                        var uniformOptions = (typeof $.uniform.options !== "undefined") ? $.uniform.options : $.uniform.defaults;
                                                        if (uniformOptions.filter) {
                                                                Row.find(uniformOptions.filter).uniform();
                                                        }
                                                }

                                                $("#ReservedIPAddrTable").append(Row);
                                                if (rowID) $("#saveChanges").show();

                                                if ((addButtonClickCount >= MaxAllowedDevicesPerSave) || ($("tr.reserveIPInfoRow").length >= MaxAllowedDevices)) {
                                                        $("#AddReservedIP").prop("disabled", true);
                                                }
                                        });
                                </tmpl_unless>
                        </tmpl_if>

                        $("#changeLink").click(function() {
                            window.location.href = "<tmpl_udf GET_URI('lan')>";
                        });

                        $("#reservedIPAddressForm").on("submit", function(e) {
                            event.preventDefault();
                            modalPopup.createWindow(
                                '<tmpl_var _("webui", "webui_modal_confirm_button")>',
                                '<p><tmpl_udf GET_PO_TEXT("adv_reserved_ip_confirm_modal_restart_text", gProductName)></p>',
                                430, 250,
                                [
                                    {
                                        text : '<tmpl_var _("webui", "webui_modal_cancel_button")>',
                                        className : "cancel",
                                    },
                                    {
                                        text : '<tmpl_var _("webui", "webui_modal_confirm_button")>',
                                        className : "primary",
                                        trigger : function() {
                                            $("#reservedIPAddressForm").submit();
                                           
                                        }
                                    }
                                ]
                            );
                        });
                });

                function handleReserveIpChange(index) 
                {
                        if ($("#reservedIpIndex" + index).is(":checked")) {
                                $("#reservedIPAddressIndex" + index).prop("disabled", false);
                                if ((!$("#reserveIPInfoRow" + index).hasClass('dyn')) && ($("#reservedIPAddressDeletedIndex" + index).length > 0)) {
                                        $("#reservedIPAddressDeletedIndex" + index).remove();
                                }
                        } else {
                                if (!$("#reserveIPInfoRow" + index).hasClass('dyn')) {
                                        var reservedIp = $("#reservedIPAddressIndex" + index).val();
                                        var item = '<input type="hidden" name="reservedIPAddressDeletedIndex' + index +'" id="reservedIPAddressDeletedIndex' + index + '" value="' + reservedIp + '" />';
                                        $("#reserveIPInfoRow" + index).append(item);
                                }
                                $("#reservedIPAddressIndex" + index).prop("disabled", true);
                        }
                }

                /* ]]> */
        </script>

<tmpl_if isLocked>
	<div class="notification app error">
		<tmpl_var _("webui", "webui_app_locked_text")>
	</div>
</tmpl_if>


<div id="pageHeadRow" class="clearfix">
	<div id="pageHeadCol">
		<h1 class="pageHead settings"><tmpl_var _("webui", "adv_reserved_ip_title")></h1>
	</div>
	<a title='<tmpl_if parent.pageTitle><tmpl_var parent.pageTitle><tmpl_else><tmpl_var parent.title></tmpl_if> <tmpl_var _("webui", "tabs_help_word")>' class="helpLink parent" href="<tmpl_var gHelpURL>"></a>
</div>
	
        <tmpl_if errorCount>
            <div class="notification app error">
                <div class="notification_inner">
                    <p>
                        <tmpl_var _("webui", "webui_save_code_failed_text")>
                    </p>
                </div>
            </div>
        </tmpl_if>

        <tmpl_if gPostSuccess>
            <div class="notification app success">
                <div class="notification_inner" id="successMsg">
                    <p>
                        <tmpl_var _("webui", "webui_save_code_success_text")>
                    </p>
                </div>
            </div>
        </tmpl_if>

        <p class="note"><tmpl_var _("webui", "adv_reserved_ip_intro")></p>
        <form id="reservedIPAddressForm" method="POST" action="<tmpl_udf GET_URI('reserved_ip')>">
                <input type="hidden" name="gSecureToken" id="gSecureToken" value="<tmpl_var gSecureToken>" />

                <fieldset id ="reservedIpField" class="first">                     
                        <div class="table">
                            <div class="row clearfix">
                                <div class="col label">
                                    <tmpl_var _("webui", "adv_reserved_ip_dhcp_range_label")>
                                </div>
                                <div class="col textCol">
                                    <tmpl_var dhcpRangeBegin>&nbsp;<tmpl_var _("webui", "webui_tilde_symbol")>&nbsp;<tmpl_var dhcpRangeEnd>
                                </div>
                            </div>
                        </div><!-- /.table -->

			<h2 class="sectionHead"><tmpl_var _("webui", "adv_reserved_ip_connected_devices_sub_header_text")></h2>
                        <table id="ReservedIPAddrTable" class="devicesTable">
                                <colgroup>
                                        <tmpl_if ShowDeviceType>
                                                <col class="deviceTypeColumn" />
                                        </tmpl_if>
                                        <col class="deviceName" />
                                        <col class="macAddressColumn" />
                                        <col class="ipaddress" /> <!-- current IP address -->
                                        <col class="checkbox" />
                                        <col class="ipaddress" /> <!-- Reserved IP address -->
                                </colgroup>
                                <thead<tmpl_unless reservedIpAddresses> style="display:none;"</tmpl_unless>>
                                        <tr>
                                                <tmpl_if ShowDeviceType>
                                                        <th class="deviceTypeColumn"><tmpl_var _("webui", "adv_reserved_ip_device_type_label")></th>
                                                </tmpl_if>
                                                <th class="deviceName"><tmpl_var _("webui", "adv_reserved_ip_device_name_label")></th>
                                                <th class="macAddressColumn"><tmpl_var _("webui", "adv_reserved_ip_device_mac_label")></th>
                                                <th class="ipaddress"><tmpl_var _("webui", "adv_reserved_ip_current_ipaddress_label")></th>
                                                <th class="checkbox"><tmpl_var _("webui", "adv_reserved_ip_reserve_label")></th>
                                                <th class="ipaddress"><tmpl_var _("webui", "adv_reserved_ip_reserved_ipaddress_label")></th>
                                        </tr>
                                </thead>
                                <tbody>
                                        <tmpl_if reservedIpAddresses>
                                                <tmpl_foreach reservedIpAddresses as item>
                                                        <tmpl_if item.reservedIPAddressAddedIndex>
                                                                <tr class="dyn reserveIPInfoRow<tmpl_if item.reserveIPInfoRowError> error</tmpl_if>" id="reserveIPInfoRow<tmpl_var (item.__index__ + 1)>">
                                                        <tmpl_else>
                                                                <tr class="deviceInformationRow reserveIPInfoRow<tmpl_if item.reserveIPInfoRowError> error</tmpl_if>" id="reserveIPInfoRow<tmpl_var (item.__index__ + 1)>">
                                                        </tmpl_if>
                                                        <tmpl_if item.reservedIPAddressDeletedIndex>
                                                                <input type="hidden" name="reservedIPAddressDeletedIndex<tmpl_var (item.__index__ + 1)>" id="reservedIPAddressDeletedIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.reservedIPaddress>" />
                                                        </tmpl_if>
                                                        <tmpl_unless item.reservedIPAddressAddedIndex>
                                                                <input type="hidden" name="reservedIPAddressKnownIndex<tmpl_var (item.__index__ + 1)>" id="reservedIPAddressKnownIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.deviceType>;<tmpl_var item.reservedIpDeviceName>;<tmpl_var item.reservedIPMacAddress>" />
                                                        </tmpl_unless>

                                                        <tmpl_if ShowDeviceType>
                                                                <td class="deviceTypeColumn">
                                                                        <select class="deviceType" id="deviceTypeIndex<tmpl_var (item.__index__ + 1)>" name="deviceTypeIndex<tmpl_var (item.__index__ + 1)>">
                                                                        <tmpl_include "supported_devices_options.tmpl">
                                                                        </select>
                                                                </td>
                                                        </tmpl_if>
                                                        <td class="deviceName">
                                                                <input type="text" maxlength="24" id="deviceNameIndex<tmpl_var (item.__index__ + 1)>" name="deviceNameIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.reservedIpDeviceName>"<tmpl_if item.hostNameError> class="error"</tmpl_if> />
                                                                <tmpl_if item.hostNameError>
                                                                        <p class="error"><tmpl_var item.hostNameError></p>
                                                                </tmpl_if>
                                                        </td>

                                                        <td class="macAddressColumn">
                                                                <tmpl_if item.reservedIPAddressAddedIndex>
                                                                        <input id="macAddressIndex<tmpl_var (item.__index__ + 1)>" name="macAddressIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.reservedIPMacAddress>"<tmpl_if item.macAddressError> class="error"</tmpl_if>/>
                                                                <tmpl_else>
                                                                        <div><tmpl_var item.reservedIPMacAddress></div>
                                                                </tmpl_if>
                                                                <tmpl_if item.macAddressError>
                                                                        <p class="error"><tmpl_var item.macAddressError></p>
                                                                </tmpl_if>
                                                        </td>

                                                        <td class="ipaddress current"> <!-- current IP Address -->
                                                                <input type="hidden" id="currentIPAddressIndex<tmpl_var (item.__index__ + 1)>" name="currentIPAddressIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.currentIPAddress>"/>
                                                                <div><tmpl_var item.currentIPAddress></div>
                                                        </td>

                                                        <td class="checkbox">
                                                                <tmpl_if item.reservedIPAddressDeletedIndex>
                                                                        <input type="checkbox" name="reservedIpIndex<tmpl_var (item.__index__ + 1)>" id="reservedIpIndex<tmpl_var (item.__index__ + 1)>" onchange="handleReserveIpChange(<tmpl_var (item.__index__ + 1)>)" />
                                                                <tmpl_elsif item.reservedIPAddressAddedIndex>
                                                                        <input type="checkbox" name="reservedIpIndex<tmpl_var (item.__index__ + 1)>" id="reservedIpIndex<tmpl_var (item.__index__ + 1)>" onchange="handleReserveIpChange(<tmpl_var (item.__index__ + 1)>)" checked="checked" />
                                                                <tmpl_else>
                                                                        <input type="checkbox" name="reservedIpIndex<tmpl_var (item.__index__ + 1)>" id="reservedIpIndex<tmpl_var (item.__index__ + 1)>"  onchange="handleReserveIpChange(<tmpl_var (item.__index__ + 1)>)" <tmpl_if item.ipAddressError>checked="checked"<tmpl_else><tmpl_unless IN_SET(item.reservedIPaddress,"")>checked="checked"</tmpl_unless></tmpl_if> />
                                                                </tmpl_if>
                                                        </td>

                                                        <td class="ipaddress reserved"> <!-- reserved IP Address -->
                                                                <tmpl_if item.reservedIPAddressDeletedIndex>
                                                                        <input id="reservedIPAddressIndex<tmpl_var (item.__index__ + 1)>" name="reservedIPAddressIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.reservedIPaddress>" disabled="disabled"/>
                                                                <tmpl_elsif item.reservedIPAddressAddedIndex>
                                                                        <input id="reservedIPAddressIndex<tmpl_var (item.__index__ + 1)>" name="reservedIPAddressIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.reservedIPaddress>" />
                                                                <tmpl_else>
                                                                        <input id="reservedIPAddressIndex<tmpl_var (item.__index__ + 1)>" name="reservedIPAddressIndex<tmpl_var (item.__index__ + 1)>" value="<tmpl_var item.reservedIPaddress>" <tmpl_if item.ipAddressError>class="error"<tmpl_else><tmpl_if IN_SET(item.reservedIPaddress,"")>disabled="disabled"</tmpl_if></tmpl_if> />
                                                                </tmpl_if>
                                                                <tmpl_if item.ipAddressError>
                                                                        <p class="error"><tmpl_var item.ipAddressError></p>
                                                                </tmpl_if>
                                                        </td>
                                                </tmpl_foreach>
                                        <tmpl_else>
                                                <tr id="ReservedIPAddrTableNoRows">
                                                        <td colspan="6">
                                                                <p><tmpl_var _("webui", "adv_reserved_ip_no_devices_msg")></p>
                                                        </td>
                                                </tr>
                                        </tmpl_if>
                                </tbody>
                        </table>                        
                </fieldset>

                <div class="button_container clearfix" id="buttonsPanel">
                    <tmpl_if ReservedIPAddDeviceShow>
                        <button type="button" id="AddReservedIP" class="secondary" <tmpl_if ReservedIPAddDeviceLocked>disabled="disabled</tmpl_if> <tmpl_if isLocked> disabled="disabled"</tmpl_if> <tmpl_if showIPPTEnable> disabled="disabled"</tmpl_if>> <tmpl_var _("webui", "adv_reserved_ip_add_reserved_ip_button")> </button>
                    </tmpl_if>
                </div>
                <div>
                    <button type="submit" id="saveChanges" class="primary" name="saveChanges" <tmpl_if isLocked> disabled="disabled"</tmpl_if> <tmpl_if showIPPTEnable> disabled="disabled"</tmpl_if>> <tmpl_var _("webui", "webui_save_button")> </button>
                    <button type="button" id="changeLink" class="secondary" <tmpl_if isLocked> disabled="disabled"</tmpl_if>> <tmpl_var _("webui", "adv_reserved_ip_return_to_lan_button")> </button>
                </div>
        </form>
</tmpl_if><!-- isHidden -->
